# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/

[graph]
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    "x86_64-pc-windows-msvc",
]
all-features = true

[advisories]
version = 2
# Ignore certain advisories (use sparingly)
ignore = []

[licenses]
version = 2
# Allowed licenses (permissive licenses compatible with MIT/Apache-2.0)
allow = [
    "MIT",
    "Apache-2.0",
    "Unicode-3.0",      # Used by ICU library dependencies
    "BSD-3-Clause",
    "ISC",
    "BSL-1.0",
    "OpenSSL",          # Used by aws-lc-sys
]
[bans]
# Warn on multiple versions of the same crate (except for known AWS SDK conflicts)
multiple-versions = "warn"
# Deny wildcard dependencies
wildcards = "deny"
# Specific crates to deny
deny = []

# Skip checks for crates with unavoidable multiple versions
# Due to AWS SDK v1.x being built with older HTTP ecosystem dependencies
# See: https://github.com/smithy-rs/smithy-rs/issues/2920
skip = [
    # HTTP ecosystem duplicates - AWS SDK uses older HTTP libraries
    { name = "http" },           # 0.2.12 (AWS SDK) vs 1.4.0 (reqwest/hyper)
    { name = "http-body" },      # 0.4.6 (AWS SDK) vs 1.0.1 (reqwest/hyper)
    { name = "h2" },             # 0.3.27 (AWS SDK) vs 0.4.12 (reqwest/hyper)
    { name = "hyper" },          # 0.14.32 (AWS SDK) vs 1.8.1 (reqwest)

    # HashBrown/IndexMap ecosystem
    { name = "hashbrown" },      # 0.14.5 (dashmap) vs 0.16.1 (indexmap)

    # RNG and crypto ecosystem
    { name = "getrandom" },      # 0.2.16 (ring) vs 0.3.4 (uuid/tempfile)

    # Platform-specific libraries
    { name = "core-foundation" }, # 0.9.4 (old security-framework) vs 0.10.1 (rustls)
    { name = "rustls" },         # Used by both reqwest and aws-smithy
    { name = "rustls-webpki" },  # Transitively pulled by rustls versions
    { name = "hyper-rustls" },   # Both old and new versions in dep tree
    { name = "tokio-rustls" },   # Both old and new versions in dep tree

    # Windows platform support
    { name = "windows-sys" },    # Multiple versions for platform support
    { name = "windows-targets" }, # Multiple versions for platform support
    { name = "windows_x86_64_gnu" },   # Platform-specific
    { name = "windows_x86_64_msvc" },  # Platform-specific

    # Other transitive duplicates
    { name = "socket2" },        # Multiple versions in dep tree
]

[sources]
# Deny crates from unknown registries
unknown-registry = "deny"
# Deny Git sources
unknown-git = "deny"
# Allow only crates.io
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []
